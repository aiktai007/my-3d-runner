<!DOCTYPE html>
<html>
<head>
    <title>Shimhkam Ultra Runner - 10 Levels</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; z-index: 10; pointer-events: none; }
        .stat-box { background: rgba(0,251,255,0.15); padding: 8px 12px; border: 2px solid #00fbff; border-radius: 8px; margin-bottom: 5px; color: #00fbff; font-weight: bold; box-shadow: 0 0 10px #00fbff; }
        #lvlDisp { color: #ffeb3b; border-color: #ffeb3b; }
        .controls { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: space-around; z-index: 20; }
        .btn { width: 70px; height: 70px; background: rgba(0,251,255,0.1); border: 2px solid #00fbff; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #00fbff; font-size: 25px; box-shadow: 0 0 15px #00fbff; }
        #nitro { width: 100px; border-radius: 15px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="ui">
        <div class="stat-box" id="lvlDisp">LEVEL: 1</div>
        <div class="stat-box">DIST: <span id="dist">0</span>m / 50000m</div>
        <div class="stat-box">COINS: <span id="coinCount">0</span></div>
    </div>
    <div class="controls">
        <div id="lBtn" class="btn">◀</div>
        <div id="nitro" class="btn">NITRO</div>
        <div id="rBtn" class="btn">▶</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x020205, 0.012);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- Sounds ---
        const bgMusic = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3');
        bgMusic.loop = true;
        const overSound = new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg');

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));

        // --- Character (ခြေလက်အစုံ) ---
        const player = new THREE.Group();
        const skinMat = new THREE.MeshStandardMaterial({color: 0xffdbac});
        const clothesMat = new THREE.MeshStandardMaterial({color: 0x00fbff});
        const head = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.4, 0.4), skinMat);
        head.position.y = 1.6;
        const torso = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.7, 0.3), clothesMat);
        torso.position.y = 1.0;
        const lLeg = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.6, 0.15), new THREE.MeshStandardMaterial({color: 0x222222}));
        lLeg.position.set(-0.15, 0.3, 0);
        const rLeg = lLeg.clone(); rLeg.position.x = 0.15;
        const lArm = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.6, 0.12), skinMat);
        lArm.position.set(-0.35, 1.1, 0);
        const rArm = lArm.clone(); rArm.position.x = 0.35;
        player.add(head, torso, lLeg, rLeg, lArm, rArm);
        scene.add(player);

        // --- Infinite Environment ---
        const road = new THREE.Mesh(new THREE.PlaneGeometry(15, 5000), new THREE.MeshStandardMaterial({color: 0x111111}));
        road.rotation.x = -Math.PI/2;
        scene.add(road);

        const buildings = [], streetLights = [];
        function createDecor(z) {
            const h = 10 + Math.random() * 15;
            const bL = new THREE.Mesh(new THREE.BoxGeometry(5, h, 5), new THREE.MeshStandardMaterial({color: 0x1a1a2e}));
            bL.position.set(-10, h/2, z);
            const bR = bL.clone(); bR.position.x = 10;
            scene.add(bL, bR); buildings.push(bL, bR);

            const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 8), new THREE.MeshStandardMaterial({color: 0x444444}));
            const bulb = new THREE.Mesh(new THREE.SphereGeometry(0.3), new THREE.MeshBasicMaterial({color: 0x00fbff}));
            bulb.position.y = 4;
            const pLight = new THREE.PointLight(0x00fbff, 2, 25);
            pLight.position.y = 4;
            const g = new THREE.Group(); g.add(pole, bulb, pLight);
            g.position.set(7, 4, z);
            scene.add(g); streetLights.push(g);
        }
        for(let i=0; i<30; i++) createDecor(-i * 45);

        // --- Gameplay Variables ---
        let score = 0, coinCount = 0, level = 1, moveL = false, moveR = false, isNitro = false;
        let baseSpeed = 0.55;
        const enemies = [], coinsArr = [];

        function spawn() {
            const z = player.position.z - 120, x = Math.random() * 10 - 5;
            const e = new THREE.Mesh(new THREE.BoxGeometry(1.5, 1.5, 1.5), new THREE.MeshStandardMaterial({color: 0xff0000}));
            e.position.set(x, 0.75, z); scene.add(e); enemies.push(e);
            
            const c = new THREE.Mesh(new THREE.SphereGeometry(0.5), new THREE.MeshBasicMaterial({color: 0xffd700}));
            c.position.set(-x, 0.6, z + 20); scene.add(c); coinsArr.push(c);
            
            // Level တက်လေ spawn နှုန်း မြန်လေ (Difficulty increases)
            let nextSpawn = Math.max(500, 2000 - (level * 150));
            setTimeout(spawn, nextSpawn);
        }
        spawn();

        // --- Controls ---
        const btn = (id, s, e) => {
            const b = document.getElementById(id);
            b.ontouchstart = (ev) => { ev.preventDefault(); s(); if(bgMusic.paused) bgMusic.play(); };
            b.ontouchend = e;
        };
        btn('lBtn', () => moveL=true, () => moveL=false);
        btn('rBtn', () => moveR=true, () => moveR=false);
        btn('nitro', () => isNitro=true, () => isNitro=false);

        function animate() {
            requestAnimationFrame(animate);
            
            // Level Logic (Every 5000m increases level)
            score = Math.floor(Math.abs(player.position.z));
            let newLevel = Math.floor(score / 5000) + 1;
            if(newLevel > level && level < 10) {
                level = newLevel;
                baseSpeed += 0.15; // Speed increase per level
                document.getElementById('lvlDisp').innerText = "LEVEL: " + level;
            }

            let speed = isNitro ? baseSpeed * 2.2 : baseSpeed;
            player.position.z -= speed;

            // Run Animation
            const wave = Math.sin(Date.now() * (0.01 + level * 0.001));
            lLeg.rotation.x = wave * 0.7; rLeg.rotation.x = -wave * 0.7;
            lArm.rotation.x = -wave * 0.7; rArm.rotation.x = wave * 0.7;

            if(moveL && player.position.x > -6) player.position.x -= 0.25;
            if(moveR && player.position.x < 6) player.position.x += 0.25;

            camera.position.set(player.position.x * 0.5, 5, player.position.z + 10);
            camera.lookAt(player.position.x, 2, player.position.z - 5);

            // Infinite World
            streetLights.forEach(l => { if(l.position.z > player.position.z + 30) l.position.z -= 1350; });
            buildings.forEach(b => { if(b.position.z > player.position.z + 50) b.position.z -= 1350; });
            if(player.position.z < road.position.z - 1000) road.position.z -= 2000;

            // Collision Check
            enemies.forEach(e => {
                if(player.position.distanceTo(e.position) < 1.6) {
                    bgMusic.pause();
                    overSound.play();
                    alert("GAME OVER! LEVEL: " + level + " DIST: " + score + "m");
                    location.reload();
                }
            });

            // Coins Check
            coinsArr.forEach((c, i) => {
                if(player.position.distanceTo(c.position) < 1.6) {
                    coinCount++; scene.remove(c); coinsArr.splice(i, 1);
                    document.getElementById('coinCount').innerText = coinCount;
                }
            });

            document.getElementById('dist').innerText = score;
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>
